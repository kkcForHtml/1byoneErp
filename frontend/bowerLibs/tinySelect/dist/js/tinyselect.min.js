/*
 * tinySelect ( http://mcfizh.github.io/tinySelect/ )
 *
 * Licensed under MIT license.
 *
 * @version 1.0.4
 * @author Pekka Harjam√§ki
 */!function(a){"use strict";var b={init:function(b,c){b.data("tinySelectObj",this),this.config=a.extend({showSearch:!0,txtLoading:"Loading...",txtAjaxFailure:"Error...",dataUrl:null,dataParser:null},c),this.state={container:null,selectBox:null,itemContainer:null,searchContainer:null,searchBox:null,$el:null,open:!1,ajaxPending:!1,selectedValue:-1,originalItemData:[],filteredItemData:[]},this.readSelect(b),this.createSelect(b)},createSelect:function(b){this.state.container=a("<div></div>").addClass("tinyselect").css({width:b.css("width")}),this.state.selectBox=a("<div></div>").addClass("selectbox").on("click",{self:this},this.onSelectBoxClicked),this.state.container.append(this.state.selectBox),this.state.dropdown=a("<div></div>").addClass("dropdown").hide(),this.state.container.append(this.state.dropdown),this.config.showSearch&&this.createSearch(this.state.dropdown),this.state.itemContainer=a("<ul></ul>").addClass("itemcontainer"),this.state.dropdown.append(this.state.itemContainer),this.createItems(),b.hide().after(this.state.container),this.state.$el=b,a(document).on("click",{self:this},this.onDocumentClicked)},createItems:function(b){var c,d;for(this.state.itemContainer.empty(),c=0;c<this.state.filteredItemData.length;c++){d=this.state.filteredItemData[c];var e=a("<li></li>").text(d.text).addClass("item").attr("data-value",d.val);d.val==this.state.selectedValue&&(this.state.selectBox.html(d.text),e.addClass("selected")),e.on("click",{self:this},this.onSelectLiClicked),this.state.itemContainer.append(e)}},createSearch:function(b){this.state.searchContainer=a("<div></div>").addClass("searchcontainer"),this.state.searchBox=a("<input type='text'></input>").addClass("searchbox").on("click",function(a){a.stopPropagation()}).on("keyup",{self:this},this.onSearchKeyPress),this.state.searchContainer.append(a("<span class='searchicon'></span>")),this.state.searchContainer.append(this.state.searchBox),this.state.dropdown.append(this.state.searchContainer)},readSelect:function(b){var c=this;b.find("option").each(function(b){var d=a(this);c.state.originalItemData.push({val:d.val(),text:d.text()})}),this.state.filteredItemData=this.state.originalItemData,this.state.selectedValue=b.val()},setAjaxIndicator:function(b){this.state.ajaxPending=!0,this.state.itemContainer.empty(),null!==this.state.searchContainer&&this.state.searchContainer.hide();var c=a("<li></li>");b?c.text(this.config.txtAjaxFailure).addClass("loaderrorindicator"):c.text(this.config.txtLoading).addClass("loadindicator"),this.state.itemContainer.append(c)},onDocumentClicked:function(a){var b=a.data.self;b.state.open&&b.onSelectBoxClicked(a)},onSearchKeyPress:function(b){var c=b.data.self,d=a(b.currentTarget).val();0===d.length?c.state.filteredItemData=c.state.originalItemData:c.state.filteredItemData=c.state.originalItemData.filter(function(a){return a.text.toLowerCase().indexOf(d)>=0}),c.createItems()},onSelectBoxClicked:function(b){var c=b.data.self;if(!c.state.dropdown.is(":animated")){if(c.state.open)return c.state.open=!1,c.state.selectBox.removeClass("open"),void c.state.dropdown.slideUp(100);null!==c.config.dataUrl&&(c.setAjaxIndicator(!1),a.ajax({url:c.config.dataUrl,dataType:"json",type:"GET"}).done(function(a){c.onAjaxLoadSuccess(c,a)}).fail(function(a){c.onAjaxLoadError(c,a)})),c.state.open=!0,c.state.selectBox.addClass("open"),c.state.dropdown.slideDown(100)}},onAjaxLoadSuccess:function(b,c){b.state.ajaxPending=!1,null!==b.config.dataParser&&(c=b.config.dataParser(c,b.state.selectedValue)),b.state.$el.empty(),c.forEach(function(c){c.selected&&(b.state.selectedValue=c.val),b.state.$el.append(a("<option></option>").text(c.text).val(c.val))}),b.state.$el.val(b.state.selectedValue),b.state.originalItemData=c,b.state.filteredItemData=c,null!==this.state.searchContainer&&this.state.searchContainer.show(),b.createItems()},onAjaxLoadError:function(a,b){a.setAjaxIndicator(!0)},onSelectLiClicked:function(b){var c=b.data.self,d=a(b.currentTarget);c.state.dropdown.find("li").each(function(){a(this).removeClass("selected")}),d.addClass("selected"),c.state.selectBox.html(d.text()),c.state.selectedValue=d.attr("data-value"),c.state.$el.val(c.state.selectedValue),c.state.$el.trigger("change")}};a.fn.tinyselect=function(c){return this.each(function(){var d=Object.create(b);d.init(a(this),c)})}}(jQuery);